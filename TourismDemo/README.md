# üèñÔ∏è TourismDemo - –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞ –µ–∫–æ—Å–∏—Å—Ç–µ–º–∞ —Ç—É—Ä–∏–∑–º—É

> **–ü–æ–≤–Ω–æ—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç—É—Ä–∞–º–∏, –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è–º–∏ —Ç–∞ –ø–ª–∞—Ç–µ–∂–∞–º–∏**
>
> –ü–æ–±—É–¥–æ–≤–∞–Ω–∞ –Ω–∞ .NET 8 –∑ MS SQL Server, –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –≤—Å—ñ –∞—Å–ø–µ–∫—Ç–∏ —Ä–æ–±–æ—Ç–∏ –∑ —Ä–µ–ª—è—Ü—ñ–π–Ω–∏–º–∏ –ë–î —Ç–∞ —Ö–æ—Ä–æ—à—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É –∫–æ–¥—É

---

## üìã –¢–∞–±–ª–∏—Ü—è –∑–º—ñ—Å—Ç—É

- [–û–≥–ª—è–¥](#–æ–≥–ª—è–¥)
- [–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ](#–æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ)
- [–í–∏–º–æ–≥–∏](#–≤–∏–º–æ–≥–∏)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç—É)
- [–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ë–î](#–∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞-–±–¥)
- [API Endpoints](#api-endpoints)
- [–í–Ω—É—Ç—Ä—ñ—à–Ω—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è](#–≤–Ω—É—Ç—Ä—ñ—à–Ω—è-—Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è)

---

## üéØ –û–≥–ª—è–¥

**TourismDemo** ‚Äî —Ü–µ –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –ø—Ä–æ–µ–∫—Ç, —è–∫–∏–π –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î:

‚úÖ **16 —Ç–∞–±–ª–∏—Ü—å —Ä–µ–ª—è—Ü—ñ–π–Ω–æ—ó –ë–î** –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ –∑–≤'—è–∑–∫–∞–º–∏ (FK, PK, CHECK constraints)
‚úÖ **Soft Delete & Audit Logging** - –¥–∞–Ω—ñ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –ª–æ–≥—ñ—á–Ω–æ, –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ª–æ–≥—É—é—Ç—å—Å—è
‚úÖ **15+ –æ–±'—î–∫—Ç—ñ–≤ –ë–î**: 5 Stored Procedures + 2 User Functions + 5 Views + 3 Triggers
‚úÖ **8+ —ñ–Ω–¥–µ–∫—Å—ñ–≤** - Non-clustered, Composite, –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –¥–æ Full-text Search
‚úÖ **Repository + Unit of Work** - —á–∏—Å—Ç–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞, –ª–µ–≥–∫–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏
‚úÖ **Minimal APIs** - —Å—É—á–∞—Å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ REST –≤ .NET 8
‚úÖ **–ü–æ–≤–Ω–æ—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥** - 4 –≤–∫–ª–∞–¥–∫–∏, 50+ –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ –ë–î

---

## ‚ú® –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

### –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞

- üé´ **–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç—É—Ä–∞–º–∏** - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è, –ø–æ—à—É–∫ –∑–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ñ—Å—Ç—é
- üìÖ **–†–æ–∑–∫–ª–∞–¥–∏ —Ç—É—Ä—ñ–≤** - –¥–∞—Ç–∏, –≤—ñ–ª—å–Ω—ñ –º—ñ—Å—Ü—è, —Å—Ç–∞—Ç—É—Å–∏
- ‚úàÔ∏è **–ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è** - –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º –≤–∏–±–æ—Ä–æ–º —Ä–æ–∑–∫–ª–∞–¥—É, –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é
- üí≥ **–ü–ª–∞—Ç–µ–∂—ñ** - –∫—ñ–ª—å–∫–∞ –º–µ—Ç–æ–¥—ñ–≤, –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
- ‚≠ê **–í—ñ–¥–≥—É–∫–∏** - —Ä–µ–π—Ç–∏–Ω–≥–∏ —Ç—É—Ä—ñ–≤, —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ
- üë®‚Äçüè´ **–ì—ñ–¥–∏** - –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–æ —Ç—É—Ä—ñ–≤, —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
- üõ°Ô∏è **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ** - —Ä–æ–ª—ñ (Admin, Tourist, Guide)

### –¢–µ—Ö–Ω—ñ—á–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

- **Soft Delete** - —É 6 —Ç–∞–±–ª–∏—Ü—è—Ö (Users, Tours, Guides, TouristProfiles, Bookings, Reviews)
- **Audit Trail** - —Ç–∞–±–ª–∏—Ü—è AuditLog + 3 —Ç—Ä–∏–≥–µ—Ä–∏ –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω
- **–ö–∞—Å–∫–∞–¥–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó** - —Ç—Ä–∏–≥–µ—Ä–∏ –æ–Ω–æ–≤–ª—é—é—Ç—å –ø–æ–≤'—è–∑–∞–Ω—ñ –¥–∞–Ω—ñ
- **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏** - –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ SQL-—ñ–Ω—î–∫—Ü—ñ–π
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω—ñ—Å—Ç—å** - stored procedures –∑ BEGIN TRY-CATCH
- **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è** - —ñ–Ω–¥–µ–∫—Å–∏ –Ω–∞ —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∏—Ö –ø–æ–ª—è—Ö

---

## üì¶ –í–∏–º–æ–≥–∏

```
.NET 8.0 SDK –∞–±–æ –≤–∏—â–µ
MS SQL Server 2019+ (–ª–æ–∫–∞–ª—å–Ω–∞ –∞–±–æ –º–µ—Ä–µ–∂–µ–≤–∞)
Git (–¥–ª—è –∫–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é)
Browser –∑ JavaScript (–¥–ª—è –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É)
```

---

## üöÄ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### 1. –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é

```bash
git clone https://github.com/Bhuuba/bd-lab-1.git
cd bd-lab-1
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ë–î

–ó–∞–ø—É—Å—Ç—ñ—Ç—å SQL —Å–∫—Ä–∏–ø—Ç–∏ –≤ —Ü—å–æ–º—É –ø–æ—Ä—è–¥–∫—É:

```bash
# –í—ñ–¥–∫—Ä–∏–π—Ç–µ SSMS –∞–±–æ Azure Data Studio
# 1. –í–∏–∫–æ–Ω–∞–π—Ç–µ DB_Schema_Full.sql - —Å—Ç–≤–æ—Ä—é—î 16 —Ç–∞–±–ª–∏—Ü—å + —ñ–Ω–¥–µ–∫—Å–∏
# 2. –í–∏–∫–æ–Ω–∞–π—Ç–µ DB_Procedures_Views_Triggers.sql - —Å—Ç–≤–æ—Ä—é—î –ø—Ä–æ—Ü–µ–¥—É—Ä–∏, —Ñ—É–Ω–∫—Ü—ñ—ó, views, —Ç—Ä–∏–≥–µ—Ä–∏
```

### 3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

–í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ `appsettings.json`:

```json
{
  "ConnectionStrings": {
    "TourismDb": "Server=YOUR_SERVER;Database=TourismDb;Trusted_Connection=True;TrustServerCertificate=True;"
  }
}
```

–ó–∞–º—ñ–Ω—ñ—Ç—å `YOUR_SERVER` –Ω–∞:

- `localhost` –∞–±–æ `.` (–ª–æ–∫–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä)
- `(localdb)\\mssqllocaldb` (LocalDB)
- `DESKTOP-XXXXX` (—ñ–º'—è –∫–æ–º–ø º—é—Ç–µ—Ä–∞)
- IP –∞–¥—Ä–µ—Å–∞ –¥–ª—è –º–µ—Ä–µ–∂–µ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

### 4. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç—É

```bash
cd TourismDemo
dotnet run
```

–ü—Ä–æ–µ–∫—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è –Ω–∞: **https://localhost:5001** (–∞–±–æ —ñ–Ω—à–∏–π port, –¥–∏–≤. –∫–æ–Ω—Å–æ–ª—å)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
bd-lab-1/
‚îú‚îÄ‚îÄ TourismDemo/
‚îÇ   ‚îú‚îÄ‚îÄ Data/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DTOs/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AllDtos.cs                    # –í—Å—ñ DTO –º–æ–¥–µ–ª—ñ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Repositories/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Interfaces/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ IAllRepositories.cs       # –ö–æ–Ω—Ç—Ä–∞–∫—Ç–∏ –¥–ª—è –≤—Å—ñ—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SqlRepositories.cs            # 5 –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UnitOfWork/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Interfaces/
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ IUnitOfWork.cs            # –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü—ñ—ó
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ SqlUnitOfWork.cs              # –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è Unit of Work
‚îÇ   ‚îú‚îÄ‚îÄ wwwroot/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.html                        # –ü–æ–≤–Ω–æ—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îú‚îÄ‚îÄ Program.cs                            # 30+ API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ TourismDemo.csproj
‚îÇ   ‚îú‚îÄ‚îÄ appsettings.json
‚îÇ   ‚îú‚îÄ‚îÄ DB_Schema_Full.sql                    # 16 —Ç–∞–±–ª–∏—Ü—å + —ñ–Ω–¥–µ–∫—Å–∏
‚îÇ   ‚îî‚îÄ‚îÄ DB_Procedures_Views_Triggers.sql      # 5 SP + 2 Functions + 5 Views + 3 Triggers
‚îî‚îÄ‚îÄ README.md (—Ü–µ–π —Ñ–∞–π–ª)
```

---

## üóÑÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ë–î

### 16 –¢–∞–±–ª–∏—Ü—å

| #   | –¢–∞–±–ª–∏—Ü—è              | Soft Delete | Audit | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è                                  |
| --- | -------------------- | :---------: | :---: | -------------------------------------------- |
| 1   | **Users**            |     ‚úÖ      |  ‚úÖ   | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Å–∏—Å—Ç–µ–º–∏ (Admin, Tourist, Guide)  |
| 2   | **Countries**        |     ‚ùå      |  ‚ùå   | –î–æ–≤—ñ–¥–Ω–∏–∫ –∫—Ä–∞—ó–Ω                               |
| 3   | **Regions**          |     ‚ùå      |  ‚ùå   | –†–µ–≥—ñ–æ–Ω–∏ –≤ –∫—Ä–∞—ó–Ω–∞—Ö                            |
| 4   | **Cities**           |     ‚ùå      |  ‚ùå   | –ú—ñ—Å—Ç–∞ –∑ GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏                     |
| 5   | **TourCategories**   |     ‚ùå      |  ‚ùå   | –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ç—É—Ä—ñ–≤ (Adventure, Beach, Cultural) |
| 6   | **Tours**            |     ‚úÖ      |  ‚úÖ   | –û—Å–Ω–æ–≤–Ω—ñ —Ç—É—Ä–∏                                 |
| 7   | **TourSchedules**    |     ‚ùå      |  ‚ùå   | –†–æ–∑–∫–ª–∞–¥–∏ —Ç—É—Ä—ñ–≤ (–¥–∞—Ç–∏, –º—ñ—Å—Ü—è)                 |
| 8   | **Guides**           |     ‚úÖ      |  ‚úÖ   | –ì—ñ–¥–∏ –∑ —Ä–µ–π—Ç–∏–Ω–≥–æ–º                             |
| 9   | **GuideAssignments** |     ‚ùå      |  ‚ùå   | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≥—ñ–¥—ñ–≤ –¥–æ —Ä–æ–∑–∫–ª–∞–¥—ñ–≤               |
| 10  | **TouristProfiles**  |     ‚úÖ      |  ‚úÖ   | –ü—Ä–æ—Ñ—ñ–ª—ñ —Ç—É—Ä–∏—Å—Ç—ñ–≤ (–ø–∞—Å–ø–æ—Ä—Ç, –≤–∏–º–æ–≥–∏)           |
| 11  | **PaymentMethods**   |     ‚ùå      |  ‚ùå   | –ú–µ—Ç–æ–¥–∏ –æ–ø–ª–∞—Ç–∏                                |
| 12  | **Bookings**         |     ‚úÖ      |  ‚úÖ   | –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —Ç—É—Ä–∏—Å—Ç—ñ–≤                          |
| 13  | **Payments**         |     ‚ùå      |  ‚ùå   | –ó–∞–ø–∏—Å–∏ –ø–ª–∞—Ç–µ–∂—ñ–≤                              |
| 14  | **Reviews**          |     ‚úÖ      |  ‚úÖ   | –í—ñ–¥–≥—É–∫–∏ –ø—Ä–æ —Ç—É—Ä–∏ (1-5 –∑—ñ—Ä–æ–∫)                 |
| 15  | **TourCategoryMaps** |     ‚ùå      |  ‚ùå   | –ó–≤'—è–∑–æ–∫ tours ‚Üî –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (M2M)              |
| 16  | **AuditLog**         |     ‚ùå      |  ‚ùå   | –ñ—É—Ä–Ω–∞–ª –≤—Å—ñ—Ö –∑–º—ñ–Ω (–¥–ª—è –∞—É–¥–∏—Ç—É)                |

### DB Objects

**Stored Procedures (5):**

- `sp_CreateBooking` - –í–∏–¥–∞–ª–µ–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑ —Ä–æ–∑–∫–ª–∞–¥–æ–º
- `sp_DeleteBooking` - Soft delete –∑ –∞—É–¥–∏—Ç–æ–º
- `sp_GetUserBookings` - –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —Ç—É—Ä–∏—Å—Ç–∞ –∑ –¥–µ—Ç–∞–ª—è–º–∏
- `sp_CreateReview` - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–¥–≥—É–∫—É –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é
- `sp_ConfirmPayment` - –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–ª–∞—Ç–µ–∂—É

**Functions (2):**

- `fn_GetAverageRating(@TourId)` - –°–µ—Ä–µ–¥–Ω—ñ–π —Ä–µ–π—Ç–∏–Ω–≥ —Ç—É—Ä—É
- `fn_GetBookingCount(@StartDate, @EndDate)` - –ö—ñ–ª—å–∫—ñ—Å—Ç—å –±—Ä–æ–Ω—é–≤–∞–Ω—å –∑–∞ –ø–µ—Ä—ñ–æ–¥

**Views (5):**

- `vw_UserBookingDetails` - –î–µ—Ç–∞–ª—ñ –±—Ä–æ–Ω—é–≤–∞–Ω—å –∑ JOIN 7 —Ç–∞–±–ª–∏—Ü—å
- `vw_ActiveGuides` - –ê–∫—Ç–∏–≤–Ω—ñ –≥—ñ–¥–∏ –∑—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ—é
- `vw_PopularTours` - –¢—É—Ä–∏ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—ñ
- `vw_AllActiveTours` - –í—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ —Ç—É—Ä–∏ –∑ –≥–µ–æ–≥—Ä–∞—Ñ—ñ—î—é
- `vw_ConfirmedBookings` - –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º –ø–ª–∞—Ç–µ–∂—É

**Triggers (3):**

- `trg_Users_Audit` - –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- `trg_Bookings_Audit` - –õ–æ–≥—É–≤–∞–Ω–Ω—è INSERT/UPDATE/DELETE –Ω–∞ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
- `trg_Reviews_UpdateModified` - –û–Ω–æ–≤–ª–µ–Ω–Ω—è ModifiedDate –ø—Ä–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ

**–Ü–Ω–¥–µ–∫—Å–∏ (8+):**

- Non-clustered: `idx_Users_Email`, `idx_Bookings_Status`
- Composite: `idx_TourSchedules_TourId_StartDate`, `idx_Reviews_TourId_Rating`
- - —â–µ 4+ –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –∑–∞–ø–∏—Ç—ñ–≤

---

## üîå API Endpoints

### Tours

```
GET    /api/tours                        # –í—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ —Ç—É—Ä–∏
GET    /api/tours/popular                # –¢–æ–ø –ø–æ–ø—É–ª—è—Ä–Ω—ñ —Ç—É—Ä–∏
GET    /api/tours/{id}/schedules         # –†–æ–∑–∫–ª–∞–¥–∏ —Ç—É—Ä—É
GET    /api/tours/{id}/average-rating    # –°–µ—Ä–µ–¥–Ω—ñ–π —Ä–µ–π—Ç–∏–Ω–≥
GET    /api/tours/{id}/reviews           # –í—Å—ñ –≤—ñ–¥–≥—É–∫–∏ –ø—Ä–æ —Ç—É—Ä
POST   /api/tours                        # Crear –Ω–æ–≤–∏–π —Ç—É—Ä
```

### Bookings

```
POST   /api/bookings                     # –ó–∞–±—Ä–æ–Ω—é–≤–∞—Ç–∏ —Ç—É—Ä
GET    /api/bookings                     # –í—Å—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
DELETE /api/bookings/{id}                # –í–∏–¥–∞–ª–∏—Ç–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è (soft delete)
```

### Reviews

```
POST   /api/reviews                      # –ó–∞–ª–∏—à–∏—Ç–∏ –≤—ñ–¥–≥—É–∫
GET    /api/tours/{tourId}/reviews       # –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–≥—É–∫–∏ —Ç—É—Ä—É
```

### Payments

```
POST   /api/payments                     # –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–ª–∞—Ç—ñ–∂
POST   /api/payments/{id}/confirm        # –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –ø–ª–∞—Ç—ñ–∂
GET    /api/bookings/{id}/payments       # –ü–ª–∞—Ç–µ–∂—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
```

### Other

```
GET    /api/tourists                     # –í—Å—ñ —Ç—É—Ä–∏—Å—Ç–∏
GET    /api/audit-logs/table/{table}/record/{id}  # –Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω –∑–∞–ø–∏—Å—É
GET    /api/audit-logs/user/{userId}    # –î—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
```

---

## üèóÔ∏è –í–Ω—É—Ç—Ä—ñ—à–Ω—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### Repository Pattern

```csharp
// –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ –∑ –º–µ—Ç–æ–¥–∞–º–∏
public interface ITourRepository
{
    Task<IEnumerable<TourDto>> GetActiveToursAsync();
    Task<IEnumerable<PopularTourDto>> GetPopularToursAsync();
    Task<TourDto> GetTourByIdAsync(int tourId);
}

// –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ SQL
public class SqlTourRepository : ITourRepository
{
    public async Task<IEnumerable<TourDto>> GetActiveToursAsync()
    {
        // –ß–∏—Ç–∞—î –∑ view vw_ActiveTours
    }
}
```

### Unit of Work

```csharp
// –ö–æ–æ—Ä–¥–∏–Ω—É—î –≤—Å—ñ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó
public interface IUnitOfWork
{
    ITourRepository Tours { get; }
    IBookingRepository Bookings { get; }
    IReviewRepository Reviews { get; }
    IPaymentRepository Payments { get; }
    IAuditLogRepository AuditLogs { get; }
    Task CommitAsync();
}

// –õ—ñ–Ω–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤ SqlUnitOfWork
```

### Dependency Injection

```csharp
// Program.cs
builder.Services.AddScoped<SqlConnection>(...);
builder.Services.AddScoped<IUnitOfWork, SqlUnitOfWork>();
```

### Stored Procedures

```csharp
// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó
var command = new SqlCommand("sp_CreateBooking", connection)
{
    CommandType = CommandType.StoredProcedure
};
command.Parameters.AddWithValue("@TourId", tourId);
var result = await command.ExecuteScalarAsync();
```

---

## üé® –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π –Ω–∞ —á–∏—Å—Ç–æ–º—É HTML + CSS + Vanilla JS:

- **4 –≤–∫–ª–∞–¥–∫–∏**: –¢—É—Ä–∏ | –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è | –í—ñ–¥–≥—É–∫–∏ | –ü–ª–∞—Ç–µ–∂—ñ
- **–†–µ–∞–∫—Ç–∏–≤–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ** –∑ –∞–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º
- **–§–æ—Ä–º—ã –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é** –Ω–∞ —Ñ—Ä–æ–Ω—Ç—ñ
- **–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫** –∑ –∫—Ä–∞—Å–∏–≤–∏–º–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –∑–∞–ø–∏—Ç–∏** —á–µ—Ä–µ–∑ Fetch API
- **–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π –¥–∏–∑–∞–π–Ω** (mobile-friendly)

---

## üìä –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–ø–∏—Ç—ñ–≤

### –û—Ç—Ä–∏–º–∞—Ç–∏ —Ç–æ–ø-5 –ø–æ–ø—É–ª—è—Ä–Ω–∏—Ö —Ç—É—Ä—ñ–≤

```bash
curl https://localhost:5001/api/tours/popular
```

**Response:**

```json
[
  {
    "tourId": 5,
    "name": "–¢–∞—ó–ª–∞–Ω–¥—Å—å–∫–∏–π –¥–∂—É–Ω–≥–ª—ñ",
    "city": "–ë–∞–Ω–≥–∫–æ–∫",
    "price": 1200,
    "bookings": 12,
    "participants": 34,
    "averageRating": 4.7
  }
]
```

### –ó–∞–±—Ä–æ–Ω—é–≤–∞—Ç–∏ —Ç—É—Ä

```bash
curl -X POST https://localhost:5001/api/bookings \
  -H "Content-Type: application/json" \
  -d '{
    "tourId": 1,
    "touristId": 2,
    "travelDate": "2024-12-20",
    "numberOfPeople": 2
  }'
```

### –ó–∞–ª–∏—à–∏—Ç–∏ –≤—ñ–¥–≥—É–∫

```bash
curl -X POST https://localhost:5001/api/reviews \
  -H "Content-Type: application/json" \
  -d '{
    "tourId": 1,
    "touristId": 2,
    "rating": 5,
    "title": "–ß—É–¥–æ–≤–∏–π —Ç—É—Ä!",
    "comment": "–í—Å–µ –±—É–ª–æ —ñ–¥–µ–∞–ª—å–Ω–æ –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤–∞–Ω–æ"
  }'
```

---

## üîí –ë–µ–∑–ø–µ–∫–∞

‚úÖ **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏** - –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ SQL-—ñ–Ω—î–∫—Ü—ñ–π
‚úÖ **Soft Delete** - –¥–∞–Ω—ñ –Ω–µ –≤—Ç—Ä–∞—á–∞—é—Ç—å—Å—è, –ª–∏—à–µ –ø–æ–∑–Ω–∞—á–∞—é—Ç—å—Å—è —è–∫ –≤–∏–¥–∞–ª–µ–Ω—ñ
‚úÖ **Audit Log** - –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ª–æ–≥—É—é—Ç—å—Å—è
‚úÖ **–í–∞–ª—ñ–¥–∞—Ü—ñ—è** - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–∞–Ω–∏—Ö –Ω–∞ —Ñ—Ä–æ–Ω—Ç—ñ —ñ –±–µ–∫–µ–Ω–¥—ñ
‚úÖ **HTTPS** - –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –õ–æ–∫–∞–ª—å–Ω–∏–π –∑–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç—É
dotnet run

# –í—ñ–¥–∫—Ä–∏–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –Ω–∞ https://localhost:5001
# –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ https://localhost:5001/swagger –¥–ª—è Swagger UI
```

### –¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ

–ë–∞–∑–∞ –≥–æ—Ç—É—î—Ç—å—Å—è –∑ —Ç–µ—Å—Ç–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏:

- 5 –∫—Ä–∞—ó–Ω, 5 —Ä–µ–≥—ñ–æ–Ω—ñ–≤, 5 –º—ñ—Å—Ç
- 5 —Ç—É—Ä—ñ–≤ —Ä—ñ–∑–Ω–æ—ó —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ
- 5 —Ä–æ–∑–∫–ª–∞–¥—ñ–≤ —Ç—É—Ä—ñ–≤
- 2 –≥—ñ–¥–∏ –∑ —Ä–µ–π—Ç–∏–Ω–≥–æ–º
- 3 —Ç—É—Ä–∏—Å—Ç–∏
- 5 –±—Ä–æ–Ω—é–≤–∞–Ω—å + –ø–ª–∞—Ç–µ–∂—ñ–≤ + –≤—ñ–¥–≥—É–∫—ñ–≤

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- `DB_Schema_Full.sql` - –ü–æ–≤–Ω–∞ —Å—Ö–µ–º–∞ –±–∞–∑–∏ (–∫–æ–º–µ–Ω—Ç–∞—Ä—ñ)
- `DB_Procedures_Views_Triggers.sql` - –ü—Ä–æ—Ü–µ–¥—É—Ä–∏, —Ñ—É–Ω–∫—Ü—ñ—ó, views, —Ç—Ä–∏–≥–µ—Ä–∏
- `Program.cs` - REST API –º–∞—Ä—à—Ä—É—Ç–∏ –∑ –∫–æ–º–µ–Ω—Ç–∞—Ä—è–º–∏
- `Data/Repositories/` - –õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏ –∑ –ë–î
- `wwwroot/index.html` - JavaScript –∫–æ–¥ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É

---

## üöÄ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

1. ‚úÖ **–°—Ö–µ–º–∞ –ë–î** - [db-diagram.io diagram](https://dbdiagram.io/)
2. üé® **UI/UX –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è** - React —á–∏ Vue –≤–µ—Ä—Å—ñ—è
3. üîê **–ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è** - JWT —Ç–æ–∫–µ–Ω–∏, OAuth
4. üß™ **Unit —Ç–µ—Å—Ç–∏** - xUnit, Moq
5. üì¶ **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—è –ø—Ä–æ–µ–∫—Ç—É
6. üìà **–ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è** - Redis –∫–µ—à, Load Balancing

---

## üìù –õ—ñ—Ü–µ–Ω–∑—ñ—è

–û—Å–≤—ñ—Ç–Ω—ñ–π –ø—Ä–æ–µ–∫—Ç. –í—ñ–ª—å–Ω–∏–π –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.

---

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

–†–æ–∑—Ä–æ–±–ª–µ–Ω–æ —è–∫ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ –Ω–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—é –ë–î –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó.

**GitHub:** [Bhuuba/bd-lab-1](https://github.com/Bhuuba/bd-lab-1)

---

**–û—Å—Ç–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:** 25 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2025 —Ä–æ–∫—É
